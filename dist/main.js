(()=>{"use strict";var e={732:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function d(e){try{u(n.next(e))}catch(e){r(e)}}function s(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(o(292));t.default=class{constructor(e){this.fileRoute=e}getAll(){return n(this,void 0,void 0,(function*(){try{return JSON.parse(yield r.default.readFile(this.fileRoute,{encoding:"utf8"}))}catch(e){return console.log("No se encontró el archivo",e),[]}}))}deleteAll(){return n(this,void 0,void 0,(function*(){try{yield r.default.writeFile(this.fileRoute,"[]"),console.log("Archivo vaciado")}catch(e){console.log("No se encontró el archivo",e)}}))}save(e=null,t=null){return n(this,void 0,void 0,(function*(){const o=yield this.getAll(),n=null!==t?t:0===o.length?1:o[o.length-1].id+1,i=Date.now(),d=e||{products:[]};o.push(Object.assign(Object.assign({},d),{id:n,timestamp:i}));try{return yield r.default.writeFile(this.fileRoute,JSON.stringify(o.sort(((e,t)=>+e.id-+t.id)))),n}catch(e){return console.log("No se pudo guardar el objeto",e),null}}))}getById(e){return n(this,void 0,void 0,(function*(){try{return(yield this.getAll()).find((t=>t.id===e))}catch(e){console.log(e)}}))}deleteById(e){return n(this,void 0,void 0,(function*(){try{const t=yield this.getAll();if(!t.find((t=>t.id==e)))throw new Error("No se encontró el producto");return yield r.default.writeFile(this.fileRoute,JSON.stringify(t.filter((t=>t.id!=e)))),"La eliminación ha sido exitosa"}catch(e){return"No se ha encontrado el elemento buscado"}}))}}},519:function(e,t,o){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o(860)),r=n(o(208)),d=n(o(741)),s=(0,i.default)();s.use(i.default.json(),i.default.urlencoded({extended:!0})),s.use("/api/products",r.default),s.use("/api/cart",d.default),s.use("*",((e,t)=>{t.status(404).send({error:-2,desc:"path not found"})}));const u=process.env.PORT||8080;s.listen(u,(()=>{console.log(`Servidor corriendo en el puerto ${u}`)}))},208:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function d(e){try{u(n.next(e))}catch(e){r(e)}}function s(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(o(860)),d=i(o(732)),s=r.default.Router(),u=(e,t,o)=>n(void 0,void 0,void 0,(function*(){o()})),c=new d.default("./products.json");s.get("/",((e,t)=>n(void 0,void 0,void 0,(function*(){const e=yield c.getAll();t.send(e)})))),s.get("/:id",((e,t)=>n(void 0,void 0,void 0,(function*(){const o=(yield c.getAll()).find((t=>t.id===e.params.id));o||t.send({error:"producto no encontrado"}),t.send(o)})))),s.post("/",u,((e,t)=>n(void 0,void 0,void 0,(function*(){(yield c.save(e.body))?t.json(e.body):t.json({error:"no se pudo guardar el producto"})})))),s.put("/:id",u,((e,t)=>n(void 0,void 0,void 0,(function*(){-1===(yield c.getAll()).findIndex((t=>t.id==e.params.id))?t.send({error:"producto no encontrado"}):(yield c.deleteById(e.params.id),yield c.save(e.body,e.params.id),t.json({mensaje:"producto modificado correctamente"}))})))),s.delete("/:id",u,((e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=yield c.deleteById(e.params.id);t.json({mensaje:o})}catch(e){t.json({error:e})}})))),t.default=s},741:function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(i,r){function d(e){try{u(n.next(e))}catch(e){r(e)}}function s(e){try{u(n.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(d,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(o(860)),d=i(o(732)),s=r.default.Router(),u=new d.default("./carts.json"),c=new d.default("./products.json");s.post("/",((e,t)=>n(void 0,void 0,void 0,(function*(){const e=yield u.save();e?t.json(e):t.json({error:"no se pudo guardar el producto"})})))),s.delete("/:id",((e,t)=>n(void 0,void 0,void 0,(function*(){try{const o=yield u.deleteById(e.params.id);t.json({msj:o})}catch(e){t.json({error:"Ocurrió un error al intentar borrar el carrito. Inténtelo nuevamente"})}})))),s.get("/:id/products",((e,t)=>n(void 0,void 0,void 0,(function*(){const o=yield u.getAll(),n=o.findIndex((t=>t.id==e.params.id));-1===n?t.send({error:"carrito no encontrado"}):t.send(o[n].products)})))),s.post("/:id/products/:id_item",((e,t)=>n(void 0,void 0,void 0,(function*(){const o=(yield u.getAll()).find((t=>t.id==e.params.id)),n=(yield c.getAll()).find((t=>t.id===e.params.id_item));o?n?(o.products.push(n),yield u.deleteById(o.id),yield u.save(o,o.id),t.json({mensaje:"producto agregado correctamente"})):t.send({error:"producto no encontrado"}):t.send({error:"carrito no encontrado"})})))),s.delete("/:id/products/:id_item",((e,t)=>n(void 0,void 0,void 0,(function*(){const o=(yield u.getAll()).find((t=>t.id==e.params.id));o?(o.products=o.products.filter((t=>t.id!=e.params.id_item)),yield u.deleteById(o.id),yield u.save(o,o.id),t.json({mensaje:"Producto eliminado correctamente"})):t.send({error:"Carrito no encontrado"})})))),t.default=s},860:e=>{e.exports=require("express")},292:e=>{e.exports=require("fs/promises")}},t={};!function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports}(519)})();